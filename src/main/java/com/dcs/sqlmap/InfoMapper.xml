<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dcs.dao.PojoToMapperDao">
  <resultMap id="InfoResultMap" type="com.dcs.pojo.ListInfo">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="excel_name" jdbcType="VARCHAR" property="excelName" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="list_id" jdbcType="INTEGER" property="listId" />
    <result column="info_id" jdbcType="INTEGER" property="infoId" />
    <result column="creator" jdbcType="INTEGER" property="creator" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="reviser" jdbcType="INTEGER" property="reviser" />
    <result column="revise_time" jdbcType="TIMESTAMP" property="reviseTime" />
    <result column="user_level" jdbcType="VARCHAR" property="userLevel" />
    <result column="data_status" jdbcType="VARCHAR" property="dataStatus" />
  </resultMap>
    <resultMap id="ListResultMap" type="com.dcs.dto.ListInfoDto">
    <result column="excel_name" jdbcType="VARCHAR" property="excelName" />
    <result column="list_id" jdbcType="INTEGER" property="listId" />
    <result column="info_id" jdbcType="INTEGER" property="infoId" />
    <result column="creator" jdbcType="VARCHAR" property="creator" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="reviser" jdbcType="VARCHAR" property="reviser" />
    <result column="revise_time" jdbcType="TIMESTAMP" property="reviseTime" />
    <result column="user_level" jdbcType="VARCHAR" property="userLevel" />
    <result column="data_status" jdbcType="VARCHAR" property="dataStatus" />
  </resultMap>
	<select id="findListInfo" resultType="com.dcs.pojo.ListInfo">
		select * from t_list_info where creator = #{creator} and list_id = #{listId}
		and data_status = "001"
		order by ${page.sortField} ${page.orderType} limit #{page.pageIndex},#{page.pageSize}  
	</select>
	
	<select id="selectInfo" resultType="java.util.HashMap">
		SELECT
			title,t_cadres_info.*
		FROM
			t_list_info,
			${table}
		WHERE
			t_cadres_info.info_id = #{infoId}
		AND t_cadres_info.info_id = t_list_info.info_id
	</select>
	
	<select id="selectListInfo" resultMap="InfoResultMap">
		select * from t_list_info where user_level = #{level} and list_id = #{listId}
		and data_status = "001"
		order by ${page.sortField} ${page.orderType} limit #{page.pageIndex},#{page.pageSize} 
	</select>
<insert id="insertList" parameterType="com.dcs.pojo.ListInfo">
    insert into t_list_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="excelName != null">
        excel_name,
      </if>
      <if test="title != null">
        title,
      </if>
      <if test="listId != null">
        list_id,
      </if>
      <if test="infoId != null">
        info_id,
      </if>
      <if test="creator != null">
        creator,
      </if>
      <if test="reviser != null">
        reviser,
      </if>
      <if test="reviseTime != null">
        revise_time,
      </if>
      <if test="userLevel != null">
        user_level,
      </if>
      create_time,data_status
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="excelName != null">
        #{excelName,jdbcType=VARCHAR},
      </if>
      <if test="title != null">
        #{title,jdbcType=VARCHAR},
      </if>
      <if test="listId != null">
        #{listId,jdbcType=INTEGER},
      </if>
      <if test="infoId != null">
        #{infoId,jdbcType=INTEGER},
      </if>
      <if test="creator != null">
        #{creator,jdbcType=INTEGER},
      </if>
      <if test="reviser != null">
        #{reviser,jdbcType=INTEGER},
      </if>
      <if test="reviseTime != null">
        #{reviseTime,jdbcType=TIMESTAMP},
      </if>
      <if test="userLevel != null">
        #{userLevel,jdbcType=VARCHAR},
      </if>
      now(),"001"
    </trim>
  </insert>
	<insert id="insertInfo" >
		insert into ${table}  
         <foreach collection="map.keys" item="key" open="(" close=")" separator="," >  
            ${key} 
         </foreach>
         values   
         <foreach collection="map.keys"  item="key" open="(" close=")" separator=",">  
            #{map[${key}]}  
         </foreach>
	</insert>

	<update id="updateInfo" >
		update ${table} set 
		<foreach collection="map.keys" item="key" separator=",">
			${key} = #{map[${key}]}
		</foreach>
		where id = #{id}
	</update>
		
	<delete id="deleteInfo">
		UPDATE ${table},
		 t_list_info
		SET t_cadres_info.data_status = "000",
		 reviser = ${reviser},
		 revise_time = now()
		WHERE
			t_cadres_info.id = #{id}
		  and t_cadres_info.info_id = t_list_info.info_id
  	</delete>
	
	<delete id="deleteList">
		update t_list_info set data_status = "000",reviser=#{reviser},revise_time=now() where id = #{id};
	</delete>
	<select id ="selectMax" resultType="java.lang.Integer">
		SELECT max(info_id) FROM ${table} where data_status = "001";
	</select>
	<select id="selectLimit" resultMap="ListResultMap">
		SELECT
			excel_name,
			list_id,
			info_id,
			tu1.real_name as reviser,
			tu2.real_name as creator,
			t_list_info.create_time,
			t_list_info.revise_time,
			user_level,
			t_list_info.data_status
		FROM
			t_list_info left join 
			t_user as tu1 on tu1.id = t_list_info.reviser,
			t_user as tu2
		where tu2.id = t_list_info.creator
		ORDER BY
			t_list_info.id DESC
		LIMIT 0,
		 10
	</select>
</mapper>